# 操作系统面试题整理
[TOC]
## 什么是操作系统？
1. 操作系统（OS）是是系统最基本最核心的软件，属于系统软件
2. 操作系统本质上是运行在计算机的软件程序，它控制和管理整个计算机的硬件和软件资源，合理的组织、调度计算机的工作与资源的分配
3. 操作系统的存在屏蔽了硬件层面的复杂性，向用户和应用程序提供了命令接口和程序接口

## 讲一讲用户态和系统态
- 用户态和系统态是处理器的两种状态
- CPU在用户态下，只能执行非特权指令，比如加减乘除这些简单指令；还有用户态运行下的程序可以访问的资源受到限制，只能访问自己程序下的数据
- CPU在系统态下，既能执行特权指令，也能执行非特权指令，特权指令是指用户不能直接调用的指令，比如I/O指令，内存清零等指令；在系统态下运行的程序访问资源不收到限制。
- 我们运行的程序基本上都在用户态运行，如果需要调用系统级别的子功能（如文件管理，进程控制，内存管理等）则需要切换到系统态，进行系统调用。通过系统调用，向操作系统提出请求，由其代为完成。

## 讲一讲系统调用
系统调用是操作系统提供给应用程序的接口，应用程序可以通过系统调用（程序接口）请求获得操作系统的服务；系统调用会使处理器从用户态切换到内核态。
按照系统调用的功能分类，可以分为
1. 设备管理：设备的请求或释放，如视频电话启动摄像头；
2. 文件管理：文件的修改、创建、删除等；
3. 进程控制：进程的创建、撤销、阻塞、唤醒等；
4. 进程通信：完成进程间的消息或信号传递；
5. 内存管理：内存分配（malloc 函数）、回收（free）、地址转换（将逻辑地址转化为物理地址等）

## 程序、进程、线程的基本概念
- 程序：
    - 程序是含有指令和数据的文件，被存储在磁盘或其他的数据存储设备中，也就是说程序是静态的代码。
- 进程
    - 在多道程序环境下，允许多个程序并发执行，此时它们将失去封闭性，并具有间断性及不可再现性的特征。为此引入了进程(Process) 的概念，以便更好地描述和控制程序的并发执行，实现操作系统的并发性和共享性（最基本的两个特性）。
    - 为了使参与并发执行的程序（含数据）能独立地运行，必须为之配置一个专门的数据结构，称为进程控制块(Process Control Block, PCB) 。系统利用PCB 来描述进程的基本情况和运行状态，进而控制和管理进程。
    - 相应地，由程序段、相关数据段和PCB三部分构成了进程映像（进程实体）。所谓创建进程，实质上是创建进程映像中的PCB; 而撤销进程，实质上是撤销进程的PCB 。值得注意的是，进程映像是静态的，进程则是动态的。
    - 引入进程实体的概念后，我们可以把传统操作系统中的进程定义为： “进程是进程实体的运行过程是系统进行资源分配的基本单位。
- 线程
    - 引入进程的目的是为了更好地使多道程序并发执行，提高资源利用率和系统吞吐量；而引入线程的目的则是为了减小程序在并发执行时所付出的时空开销，提高操作系统的并发性能。
    - 线程最直接的理解就是“轻量级进程”，它是一个基本的CPU执行单元，也是程序执行流的最小单元，由线程ID 、程序计数器、寄存器集合和堆栈组成。线程是进程中的一个实体，是被系统独立调度和分派的基本单位，线程自己不拥有系统资源，只拥有一点儿在运行中必不可少的资源，但它可与同属一个进程的其他线程共享进程所拥有的全部资源。一个线程可以创建和撤销另一个线程，同一进程中的多个线程之间可以并发执行。由于线程之间的相互制约，致使线程在运行中呈现出间断性。线程也有就绪、阻塞和运行三种基本状态。

## 程序和进程比较
1. 程序是永存的(除非删除)；进程是暂时的，是程序在数据集上的一次执行，有创建有撤销，存在是暂时的；
2. 程序是静态的观念，进程是动态的观念；
3. 进程具有并发性，而程序没有；
4. 进程是竞争计算机资源的基本单位，程序不是。
5. 进程和程序不是一一对应的： 一个程序可对应多个进程即多个进程可执行同一程序； 一个进程同一时间内执行一个程序。
    1. 在Windows下，浏览器一般是一个页面对应一个进程，所以可以理解为一个程序可以对应多个进程。

## 为什么要引入进程
在多道程序同时运行的背景下，进程之间需要共享系统资源，因此会导致各程序在执行过程中出现相互制约的关系，程序的执行会表现出间断性的特征。这些特征都是在程序的执行过程中发生的，是动态的过程，而传统的程序本身是一组指令的集合，是一个静态的概念，无法描述程序在内存中的执行情况，即我们无法从程序的字面上看出它何时执行、何时停顿，也无法看出它与其他执行程序的关系，因此，程序这个静态概念已不能如实反映程序并发执行过程的特征。为了深刻描述程序动态执行过程的性质乃至更好地支持和管理多道程序的并发执行，人们引入了进程的概念。

## 进程是如何解决问题的？
进程把能够识别程序运行态的一些变量存放在PCB中，通过这些变量系统能够更好地了解进程的状况，并在适当时进行进程的切换，以避免一些资源的浪费，甚至划分为更小的调度单位线程来提高系统的并发度。

## 线程与进程的比较
1. 调度。在传统的操作系统中，拥有资源和独立调度的基本单位都是进程。在引入线程的操作系统中，线程是独立调度的基本单位，进程是拥有资源的基本单位。在同一进程中，线程的切换不会引起进程切换。在不同进程中进行线程切换，如从一个进程内的线程切换到另一个进程中的线程时，会引起进程切换。
2. 拥有资源。不论是传统操作系统还是设有线程的操作系统，进程都是拥有资源的基本单位，而线程不拥有系统资源（也有一点儿必不可少的资源），但线程可以访问其隶属进程的系统资源。要知道，若线程也是拥有资源的单位，则切换线程就需要较大的时空开销，线程这个概念的提出就没有意义。
3. 并发性。在引入线程的操作系统中，不仅进程之间可以并发执行，而且多个线程之间也可以并发执行，从而使操作系统具有更好的并发性，提高了系统的吞吐量。
4. 系统开销。由于创建或撤销进程时，系统都要为之分配或回收资源，如内存空间、I/0 设备等，因此操作系统所付出的开销远大于创建或撤销线程时的开销。类似地，在进行进程切换时，涉及当前执行进程CPU 环境的保存及新调度到进程CPU 环境的设置，而线程切换时只需保存和设置少量寄存器内容，开销很小。此外，由于同一进程内的多个线程共享进程的地址空间，因此这些线程之间的同步与通信非常容易实现，甚至无须操作系统的干预。
5. 地址空间和其他资源（如打开的文件）。进程的地址空间之间互相独立，同一进程的各线程间共享进程的资源，某进程内的线程对于其他进程不可见。
6. 通信方面。进程间通信(IPC) 需要进程同步和互斥手段的辅助，以保证数据的一致性，而线程间可以直接读／写进程数据段（如全局变量）来进行通信。

## 为什么要引入线程？
进程存在着很多缺陷，主要集中在两点：
 (1)进程只能在同一时间干一件事情，如果想同时干两件事或多件事情，进程就无能为力了。 
 (2)进程在执行的过程中如果由于某种原因阻塞了，例如等待输入，整个进程就会挂起，其他与输入无关的工作也必须等待输入结束后才能顺序执行。 
 为了解决上述两点缺陷，引入了线程这个概念。
 
 引入进程的目的是为了更好地使多道程序并发执行，提高资源利用率和系统吞吐量；而引入线程的目的则是为了减小程序在并发执行时所付出的时空开销，提高操作系统的并发性能。